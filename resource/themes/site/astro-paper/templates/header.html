{{define "site/header"}}
<!DOCTYPE html>
<html lang="{{.Tr.Locale}}">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="HandheldFriendly" content="True">
    {{if .Noindex}}<meta name="robots" content="noindex">{{end}}
    <meta name="description" content="{{.Desc}}">
    <meta name="keywords" content="{{.Keywords}}">
    <meta name="author" content="{{.Conf.User.Nickname}}">
    
    <title>{{.Title}}</title>
    
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" href="/logo.png">
    <link rel="shortcut icon" href="/logo.png">
    <link rel="apple-touch-icon" href="/logo.png">
    
    <link rel="alternate" type="application/rss+xml" title="{{.Conf.Site.SpaceName}} » Feed"
        href="https://{{.Conf.Site.Domain}}/feed/rss">
    <link rel="alternate" type="application/atom+xml" title="{{.Conf.Site.SpaceName}} » Feed"
        href="https://{{.Conf.Site.Domain}}/feed/atom">
    <link rel="alternate" type="application/json" title="{{.Conf.Site.SpaceName}} » Feed"
        href="https://{{.Conf.Site.Domain}}/feed/json">
    
    {{if not .Noindex}}<link rel="canonical" href="https://{{.Conf.Site.Domain}}{{.Path}}">{{end}}
    
    <meta property="og:title" content="{{.Title}}">
    <meta property="og:description" content="{{.Desc}}">
    <meta property="og:url" content="https://{{.Conf.Site.Domain}}{{.Path}}">
    <meta property="og:type" content="{{.OgType}}">
    <meta property="og:site_name" content="{{.Conf.Site.SpaceName}}">
    {{if eq .OgType "article"}}<meta property="og:image" content="{{firstImage .Data.article.Content (printf "https://%s/logo.png" .Conf.Site.Domain)}}">
    {{else}}<meta property="og:image" content="https://{{.Conf.Site.Domain}}/logo.png">{{end}}
    {{if eq .OgType "article"}}
    <meta property="article:published_time" content="{{iso8601 .Data.article.CreatedAt}}">
    <meta property="article:modified_time" content="{{iso8601 .Data.article.UpdatedAt}}">
    <meta property="article:author" content="{{.Conf.User.Nickname}}">
    {{range .Data.article.Tags}}<meta property="article:tag" content="{{.}}">
    {{end}}{{end}}
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{.Title}}">
    <meta name="twitter:description" content="{{.Desc}}">
    {{if eq .OgType "article"}}<meta name="twitter:image" content="{{firstImage .Data.article.Content (printf "https://%s/logo.png" .Conf.Site.Domain)}}">
    {{else}}<meta name="twitter:image" content="https://{{.Conf.Site.Domain}}/logo.png">{{end}}
    
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://unpkg.com">
    <link rel="dns-prefetch" href="https://gravatar.loli.net">
    <link rel="dns-prefetch" href="https://api.dicebear.com">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"></noscript>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css">
    <link rel="stylesheet" href="/static/site/astro-paper/css/custom.css?v2026012900">
    
    <link rel="preconnect" href="https://fonts.googleapis.cn">
    <link rel="preconnect" href="https://fonts.gstatic.cn" crossorigin>
    <link href="https://fonts.googleapis.cn/css2?family=Noto+Sans+SC:wght@300;400;500;600;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    <noscript><link href="https://fonts.googleapis.cn/css2?family=Noto+Sans+SC:wght@300;400;500;600;700&display=swap" rel="stylesheet"></noscript>
    
    <script>
        (function() {
            const html = document.documentElement;
            const savedTheme = localStorage.getItem('solitudes_theme') || 'auto';
            
            function applyTheme(theme) {
                if (theme === 'dark' || (theme === 'auto' && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                    html.classList.add('dark');
                    html.setAttribute('data-theme', 'dark');
                } else {
                    html.classList.remove('dark');
                    html.setAttribute('data-theme', 'light');
                }
            }

            applyTheme(savedTheme);

            // Handle title placeholder replacement
            const params = new URLSearchParams(window.location.search);
            const w = params.get('w') || "";
            if (w) {
                document.title = document.title.replace("#SOL.9527.WORD#", w);
            } else {
                document.title = document.title.replace("#SOL.9527.WORD#", "");
            }
            
            window.updateThemeIcons = function(theme) {
                document.querySelectorAll('.theme-icon').forEach(el => el.style.display = 'none');
                document.querySelectorAll('.theme-icon-' + theme).forEach(el => el.style.display = 'block');
            };

            window.toggleTheme = function() {
                const currentTheme = localStorage.getItem('solitudes_theme') || 'auto';
                const themeOrder = ['light', 'dark', 'auto'];
                const currentIndex = themeOrder.indexOf(currentTheme);
                const newTheme = themeOrder[(currentIndex + 1) % 3];
                localStorage.setItem('solitudes_theme', newTheme);
                applyTheme(newTheme);
                updateThemeIcons(newTheme);
            };

            window.addEventListener('DOMContentLoaded', () => {
                updateThemeIcons(savedTheme);
                const searchInput = document.getElementById('search-input');
                if (searchInput && w) {
                    searchInput.value = w;
                }
            });
        })();
    </script>
    <style>
        .skip-to-content {
            position: absolute;
            left: -9999px;
            z-index: 999;
            padding: 1rem;
            background: var(--accent);
            color: white;
            text-decoration: none;
            border-radius: 0.5rem;
        }
        .skip-to-content:focus {
            left: 1rem;
            top: 1rem;
            outline: 2px solid var(--accent);
        }
        /* Mode Toggle Icons - controlled by JS */
        /* Default: show auto icon, JS will update based on saved preference */
        .theme-icon { display: none; }
        .theme-icon-auto { display: block; }
    </style>
</head>

<body class="min-h-screen bg-background text-foreground font-sans antialiased flex flex-col">
    <a href="#main-content" class="skip-to-content">{{.Tr.T "skip_to_content"}}</a>

<header class="bg-background sticky top-0 z-50">
    <div class="app-layout">
        <div class="py-4 sm:py-6 border-b border-border">
            <div class="flex items-center justify-between">
                <a href="/" class="text-xl font-semibold sm:text-2xl text-foreground no-underline hover:text-accent">
                    {{.Conf.Site.SpaceName}}
                </a>
                
                <nav class="flex items-center gap-4">
                    <button id="mobile-menu-btn" class="sm:hidden p-2 text-foreground hover:text-accent" aria-label="{{.Tr.T "toggle_menu"}}">
                        <i class="fa-solid fa-bars text-xl"></i>
                    </button>
                    
                    <ul id="desktop-menu" class="hidden sm:flex items-center gap-2">
                        {{range index .Theme "astro-paper.headermenus"}}
                        {{$isActive := or (and (eq .link "/") (eq $.Path "/")) (and (ne .link "/") (hasPrefix $.Path .link))}}
                        <li>
                            <a href="{{.link}}" class="px-3 py-2 text-sm font-bold hover:text-accent transition{{if $isActive}} nav-link-active{{end}}" {{if .black}}target="_blank" rel="noopener noreferrer"{{end}}>
                                {{if .icon}}<i class="{{.icon}}"></i>{{end}}
                                {{.name}}
                            </a>
                        </li>
                        {{end}}
                        <li>
                            <button onclick="window.toggleTheme()" class="px-3 py-2 text-sm font-medium hover:text-accent transition" aria-label="{{.Tr.T "toggle_theme"}}">
                                <i class="theme-icon theme-icon-light fa-solid fa-sun"></i>
                                <i class="theme-icon theme-icon-dark fa-solid fa-moon"></i>
                                <i class="theme-icon theme-icon-auto fa-solid fa-circle-half-stroke"></i>
                            </button>
                        </li>
                    </ul>
                </nav>
            </div>
            <ul id="mobile-menu" class="hidden bg-background border-t border-border mt-4 p-4 sm:hidden">
                {{range index .Theme "astro-paper.headermenus"}}
                {{$isActive := or (and (eq .link "/") (eq $.Path "/")) (and (ne .link "/") (hasPrefix $.Path .link))}}
                <li>
                    <a href="{{.link}}" class="block px-3 py-2 font-bold hover:text-accent{{if $isActive}} nav-link-active{{end}}" {{if .black}}target="_blank" rel="noopener noreferrer"{{end}}>
                        {{if .icon}}<i class="{{.icon}}"></i>{{end}}
                        {{.name}}
                    </a>
                </li>
                {{end}}
                <li>
                    <button onclick="window.toggleTheme()" class="flex items-center gap-3 w-full text-left px-3 py-2 hover:text-accent" aria-label="{{.Tr.T "toggle_theme"}}">
                        <div class="w-5 text-center">
                            <i class="theme-icon theme-icon-light fa-solid fa-sun"></i>
                            <i class="theme-icon theme-icon-dark fa-solid fa-moon"></i>
                            <i class="theme-icon theme-icon-auto fa-solid fa-circle-half-stroke"></i>
                        </div>
                        <span>{{.Tr.T "toggle_theme"}}</span>
                    </button>
                </li>
            </ul>
        </div>
    </div>
</header>


{{if ne .Path "/"}}
{{if .Data.article}}
<div class="app-layout flex items-center justify-start">
    <button onclick="history.back()" class="group inline-flex items-center gap-1 hover:text-accent -ms-2 mt-8 mb-2 bg-transparent border-none cursor-pointer text-foreground text-base">
        <i class="fa-solid fa-chevron-left text-xs group-hover:-translate-x-1 transition-transform"></i>
        <span>{{.Tr.T "go_back"}}</span>
    </button>
</div>
{{if not .Noindex}}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "{{.Tr.T "home"}}",
      "item": "https://{{.Conf.Site.Domain}}/"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "{{.Tr.T "posts"}}",
      "item": "https://{{.Conf.Site.Domain}}/posts/"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "{{jsonEscape .Data.article.Title}}",
      "item": "https://{{.Conf.Site.Domain}}/{{.Data.article.Slug}}"
    }
  ]
}
</script>
{{end}}
{{else}}
<nav class="app-layout mt-8 mb-1" aria-label="breadcrumb">
    <ul class="font-light flex items-center gap-2">
        <li>
            <a href="/" class="opacity-80 hover:opacity-100 transition">{{.Tr.T "home"}}</a>
        </li>
        <li class="opacity-50 font-thin">&raquo;</li>
        <li>
            {{if .Data.tag}}
            <a href="/tags/" class="opacity-80 hover:opacity-100 transition">{{.Tr.T "tags"}}</a>
            </li>
            <li class="opacity-50 font-thin">&raquo;</li>
            <li><span class="opacity-75">{{.Data.tag}}</span>
            {{else if eq .Path "/tags/"}}
            <span class="opacity-75">{{.Tr.T "tags"}}</span>
            {{else if eq .Path "/posts/"}}
            <span class="opacity-75 text-foreground">{{.Tr.T "posts"}}</span>
            {{else if eq .Path "/search/"}}
            <span class="opacity-75">{{.Tr.T "search"}}</span>
            {{else}}
            <span class="opacity-75">{{.Tr.T "post"}}</span>
            {{end}}
        </li>
    </ul>
</nav>
{{if not .Noindex}}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "{{.Tr.T "home"}}",
      "item": "https://{{.Conf.Site.Domain}}/"
    }{{if .Data.tag}},
    {
      "@type": "ListItem",
      "position": 2,
      "name": "{{.Tr.T "tags"}}",
      "item": "https://{{.Conf.Site.Domain}}/tags/"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "{{jsonEscape .Data.tag}}",
      "item": "https://{{.Conf.Site.Domain}}/tags/{{.Data.tag}}/"
    }{{else if eq .Path "/tags/"}},
    {
      "@type": "ListItem",
      "position": 2,
      "name": "{{.Tr.T "tags"}}",
      "item": "https://{{.Conf.Site.Domain}}/tags/"
    }{{else if eq .Path "/posts/"}},
    {
      "@type": "ListItem",
      "position": 2,
      "name": "{{.Tr.T "posts"}}",
      "item": "https://{{.Conf.Site.Domain}}/posts/"
    }{{else if eq .Path "/search/"}},
    {
      "@type": "ListItem",
      "position": 2,
      "name": "{{.Tr.T "search"}}",
      "item": "https://{{.Conf.Site.Domain}}/search/"
    }{{end}}
  ]
}
</script>
{{end}}
{{end}}
{{end}}

<script>
    document.getElementById('mobile-menu-btn').addEventListener('click', function() {
        const mobileMenu = document.getElementById('mobile-menu');
        mobileMenu.classList.toggle('hidden');
    });
</script>
{{end}}
